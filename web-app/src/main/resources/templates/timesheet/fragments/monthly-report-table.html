<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Monthly Report Table Fragment -->
<div th:fragment="reportTable">
    <!-- Success Message -->
    <div th:if="${successMessage}" class="r-success-message" style="margin-bottom: 1rem; padding: 0.75rem; background-color: var(--wa-color-success-50); border: 1px solid var(--wa-color-success-200); border-radius: var(--wa-border-radius-small); color: var(--wa-color-success-700);">
        <span th:text="${successMessage}">Success message</span>
    </div>

    <!-- Error Message -->
    <div th:if="${errorMessage}" class="r-error-message" style="margin-bottom: 1rem; padding: 0.75rem; background-color: var(--wa-color-danger-50); border: 1px solid var(--wa-color-danger-200); border-radius: var(--wa-border-radius-small); color: var(--wa-color-danger-700);">
        <span th:text="${errorMessage}">Error message</span>
    </div>

    <!-- Approve Section - Only show when status filter is SUBMITTED and there are submitted entries -->
    <div class="r-approve-section" 
         th:if="${selectedStatus == 'SUBMITTED' and reportEntries != null and !reportEntries.empty and reportEntries.?[status == 'SUBMITTED'].size() > 0}"
         style="margin-bottom: 1.5rem; padding: 1rem; background-color: var(--wa-color-neutral-50); border-radius: var(--wa-border-radius-medium); border: 1px solid var(--wa-color-neutral-200);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
            <h3 style="margin: 0; color: var(--wa-color-neutral-700); font-size: var(--wa-font-size-large);">Timesheet Approval</h3>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: var(--wa-font-size-small); color: var(--wa-color-neutral-600);">
                    Approve submitted entries for current filters
                </span>
            </div>
        </div>
        
        <form id="approveTimesheetForm"
              hx-post="/htmx/timesheet/monthly-report/approve"
              hx-target="#reportTableContainer"
              hx-confirm="Are you sure you want to approve all submitted timesheet entries matching the current filters?"
              hx-indicator="#approveLoadingIndicator">
            
            <!-- Hidden fields to preserve current filter state -->
            <input type="hidden" name="month" th:value="${selectedYear + '-' + selectedMonth + '-01'}"/>
            <input type="hidden" name="projectId" th:value="${selectedProjectId}"/>
            <input type="hidden" name="employeeId" th:value="${selectedEmployeeId}"/>
            <input type="hidden" name="status" th:value="${selectedStatus}"/>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: var(--wa-font-size-small); color: var(--wa-color-neutral-600);">
                    <span th:if="${selectedProjectId == null and selectedEmployeeId == null}">
                        This will approve ALL submitted entries for this month
                    </span>
                    <span th:if="${selectedProjectId != null or selectedEmployeeId != null}">
                        This will approve submitted entries matching current filters
                    </span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <wa-spinner id="approveLoadingIndicator" size="small" class="htmx-indicator"></wa-spinner>
                    <wa-button type="submit" variant="primary" size="small">
                        <wa-icon name="check-circle" slot="prefix"></wa-icon>
                        Approve Timesheets
                    </wa-button>
                </div>
            </div>
        </form>
    </div>
    <!-- Status Indicators -->
    <div class="r-status-indicators">
        <div class="r-status-indicator r-total-hours-logged">
            <span>üìä</span>
            <span class="r-hours-badge" th:text="${reportSummary?.totalHours ?: '0'}" id="totalHoursIndicator">0</span>
            <span>Total Hours Logged</span>
        </div>
        <div class="r-status-indicator r-approved-entries">
            <span>‚úÖ</span>
            <span class="r-hours-badge" th:text="${reportSummary?.approvedEntries ?: '0'}" id="approvedEntriesIndicator">0</span>
            <span>Approved Entries</span>
        </div>
        <div class="r-status-indicator r-pending-approvals">
            <span>‚è≥</span>
            <span class="r-hours-badge" th:text="${reportSummary?.pendingApprovals ?: '0'}" id="pendingApprovalsIndicator">0</span>
            <span>Pending Approvals</span>
        </div>
    </div>

    <table class="r-monthly-report-table">
        <thead>
            <tr>
                <th style="width: 80px;">Date</th>
                <th style="width: 120px;">Employee Name</th>
                <th style="width: 80px;">Hours Worked</th>
                <th style="width: 150px;">Project</th>
                <th style="width: 120px;">Task</th>
                <th style="width: 100px;">Status</th>
                <th style="width: 200px;">Notes</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamic data when available -->
            <tr th:each="entry : ${reportEntries}">
                <td class="r-date-cell" th:text="${entry.date}">2024-07-01</td>
                <td class="r-employee-name" th:text="${entry.employeeName}">Employee Name</td>
                <td class="r-hours-worked" th:text="${entry.hoursWorked}">8</td>
                <td class="r-project-name" th:text="${entry.projectName}">Project Name</td>
                <td class="r-task-description" th:text="${entry.task ?: '-'}">Task Description</td>
                <td class="r-status-cell">
                    <wa-badge th:if="${entry.status == 'DRAFT'}" variant="neutral" th:text="${entry.status}" size="small"></wa-badge>
                    <wa-badge th:if="${entry.status == 'SUBMITTED'}" variant="warning" th:text="${entry.status}" size="small"></wa-badge>
                    <wa-badge th:if="${entry.status == 'APPROVED'}" variant="success" th:text="${entry.status}" size="small"></wa-badge>
                    <wa-badge th:if="${entry.status == 'REJECTED'}" variant="danger" th:text="${entry.status}" size="small"></wa-badge>
                    <wa-badge th:if="${entry.status == 'PENDING'}" variant="neutral" th:text="${entry.status}" size="small"></wa-badge>
                </td>
                <td class="r-notes-cell" th:text="${entry.notes ?: '-'}">Notes</td>
            </tr>
        </tbody>
    </table>

    <!-- Empty state -->
    <div th:if="${reportEntries == null or reportEntries.empty}" class="r-empty-state">
        <div class="r-empty-state-icon">üìä</div>
        <h3>No timesheet entries found</h3>
        <p>No time entries match your current filter criteria.</p>
        <p>Try adjusting the date range or removing some filters.</p>
    </div>
</div>

</html>
